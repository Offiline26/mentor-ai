<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Mentor AI • Registro</title>
    <style>
        :root{ --bg:#0f172a; --card:#111827; --fg:#e5e7eb; --muted:#9ca3af; --accent:#22d3ee;}
        *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
        body{margin:0;min-height:100vh;display:grid;place-items:center;background:linear-gradient(120deg,#0f172a,#1f2937)}
        .card{width:min(720px,94vw);background:var(--card);color:var(--fg);padding:28px;border-radius:16px;box-shadow:0 16px 50px rgba(0,0,0,.35)}
        h1{margin:0 0 8px;font-size:22px}
        p.sub{margin:0 0 18px;color:var(--muted)}
        label{display:block;margin:.6rem 0 .35rem;color:var(--muted);font-size:13px}
        input,select{width:100%;padding:11px 12px;border-radius:10px;border:1px solid #374151;background:#0b1220;color:var(--fg)}
        .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        .row{display:flex;gap:12px}
        button{padding:12px 14px;border:0;border-radius:10px;background:var(--accent);color:#082f49;font-weight:700;cursor:pointer}
        .msg{margin:.6rem 0;padding:10px 12px;border-radius:10px;font-size:13px}
        .err{background:#7f1d1d;color:#fecaca}
        .ok{background:#052e16;color:#bbf7d0}
        a{color:#67e8f9;text-decoration:none}
    </style>
</head>
<body>
<main class="card">
    <h1>Criar conta</h1>
    <p class="sub">Preencha seus dados para começar.</p>

    <div id="msg" class="msg" style="display:none"></div>

    <form id="formRegister" onsubmit="return enviar(event)">
        <div class="grid">
            <div>
                <label for="nome">Nome completo</label>
                <input id="nome" name="nome" required/>
            </div>
            <div>
                <label for="email">E-mail</label>
                <input id="email" type="email" name="email" required/>
            </div>

            <div>
                <label for="senha">Senha</label>
                <input id="senha" type="password" name="senha" minlength="6" required/>
            </div>
            <div>
                <label for="nasc">Data de nascimento</label>
                <input id="nasc" type="date" name="dataNascimento"/>
            </div>

            <div>
                <label for="genero">Gênero</label>
                <select id="genero" name="genero">
                    <option value="">(opcional)</option>
                    <option value="MASCULINO">Masculino</option>
                    <option value="FEMININO">Feminino</option>
                    <option value="OUTRO">Outro</option>
                    <option value="PREFIRO_NAO_INFORMAR">Prefiro não informar</option>
                </select>
            </div>
            <div>
                <label for="pais">País</label>
                <input id="pais" name="pais" placeholder="Brasil"/>
            </div>

            <div>
                <label for="cargo">Cargo desejado</label>
                <select id="cargo" name="idCargo" required>
                    <option value="">Selecione…</option>
                    <option th:each="cargo : ${cargos}"
                            th:value="${cargo.id}"
                            th:text="${cargo.nome}">
                    </option>
                </select>
            </div>
            <div>
                <label for="area">Área de atuação</label>
                <select id="area" name="idAreaAtuacao" required>
                    <option value="">Selecione…</option>
                    <option th:each="area : ${areasAtuacao}"
                            th:value="${area.id}"
                            th:text="${area.nome}">
                    </option>
                </select>
            </div>
        </div>

        <div class="row" style="margin-top:14px">
            <button type="submit">Registrar</button>
            <a th:href="@{/login}" style="align-self:center">Já tenho conta</a>
        </div>
    </form>
</main>

<script>
    const msg = document.getElementById('msg');

    async function enviar(ev){
        ev.preventDefault();
        msg.style.display='none';

        const body = {
            nome: document.getElementById('nome').value.trim(),
            email: document.getElementById('email').value.trim().toLowerCase(),
            senha: document.getElementById('senha').value,
            dataNascimento: document.getElementById('nasc').value || null,
            genero: document.getElementById('genero').value || null,
            pais: document.getElementById('pais').value || null,
            idCargo: Number(document.getElementById('cargo').value),
            idAreaAtuacao: Number(document.getElementById('area').value)
        };

        try{
            const r = await fetch('/api/auth/register', {
                method: 'POST',
                headers: { 'Content-Type':'application/json' },
                body: JSON.stringify(body)
            });

            const payload = await r.json().catch(()=> ({}));
            if(r.ok){
                window.location.href = '/login?registered';
            }else{
                msg.className='msg err';
                msg.textContent = payload.error || 'Falha no cadastro';
                msg.style.display='block';
            }
        }catch(e){
            msg.className='msg err';
            msg.textContent='Erro de rede';
            msg.style.display='block';
        }
        return false;
    }
</script>
</body>
</html>
